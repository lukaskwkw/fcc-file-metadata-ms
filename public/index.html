
<!DOCTYPE html>
<html>
<style type="text/css">
	.progress {
		text-align: center;
		width: 80%;
		background-color: #4E8;
		height: 1vmin;
	}
	.bar {
		background-color: green;
		height: 100%;
		width: 0;
	}
</style>
<body>
	<p>
		This is a very simple test harness which posts to 
		<a href="https://cryptic-ridge-9197.herokuapp.com//api/fileanalyse">
			https://cryptic-ridge-9197.herokuapp.com//api/fileanalyse</a>
			Take a look at look at <i>View page source</i> to see how it works.
		</p>
		<form id="file-form" enctype="multipart/form-data" method="post" action="/fileanalyse">
			<input type="file" name="the-file" />
			<input type="submit" value="Upload" />
		</form>

		<div class="progress">
			<div class="bar"></div >
				<div class="percent">0%</div >
				</div>

				<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
				<script type="text/javascript" src="http://malsup.github.io/min/jquery.form.min.js"></script>
				<script type="text/javascript">
					$(document).ready(function() {

						var files;
						

						$('input[type=file]').on('change', function() {
							files = event.target.files;
							console.log(files['0'].size);

						});
						var bar = $('.bar');
						var percent = $('.percent');

						var u  = window.location.origin + '/fileanalyse';
						console.log(u);
						$('form').submit(function(event) {
							/* Act on the event */
							event.stopPropagation();
							event.preventDefault();
							if (true/*files['0'].size<1048576*/)
							$(this).ajaxSubmit({
								cache: false,
								processData: false,
								contentType: false,
								beforeSend: function() {
									var data = new FormData();
									$.each(files, function(key, value) {
										console.log(key, ' : ' , value );
										data.append(key, value);
									});
									console.log(JSON.stringify(data));
									var percentVal = '0%';
									bar.width(percentVal);
									percent.html(percentVal);

								},
								uploadProgress: function(event, position, total, percentComplete) {
									var percentVal = percentComplete + '%';
									bar.width(percentVal);
									percent.html(percentVal);
								},
								error: function(jqXHR, textStatus, errorThrown) {
									alert('ERRORS: ' + textStatus);
								},
								success: function(data) {
									alert(data);
								}
							});
						else {
							alert("File is to big. Choose file with size under 1 MB")
						}
							return false; //in order to prevent normal form submiting

						});
});

</script>
</body>
</html>